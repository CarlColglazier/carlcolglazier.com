---
title: "Albums from 2017 I'm Still Listening to in 2018"
author: ["Carl Colglazier"]
date: 2018-12-08T10:02:00-05:00
draft: false
image: "albums.png"
---

I listen to a _lot_ of music. While I will listen to some albums a
few times and move on, some stay with me. This post quantifies the
albums from 2017 that stayed in my life in 2018.

Each December, I compile [a list](https://gist.github.com/CarlColglazier/913963cc7197fb7a024d736c96545439) of my favorite recent albums from the
past year. People really enjoy reading lists, so pretty much every
music publication also releases a end-of-year list around the same
time&nbsp;[^fn:1].

As fun as it is to parse through yearly lists, liking an album is no
guarantee of future streams. Sometimes there are albums like Sufjan
Steven's _Carrie & Lowell_ which, although exceptional, are do not
exactly make the best background music for homework. Other times
I might really en joy an album on repeat for a period of time, but
I eventually move on the something else. I might get a nice feeling
of nostalgia looking back at the record and how I now associate it
with that time period, but there would be no way to replicate that
initial infatuation.

In the streaming era, my music library is sometimes a bit like a
midnight refrigerator run: there's always plenty inside, but at the
moment I might just be looking for something quick and easy. Thus this
list is probably best described as my musical comfort food. There are
the albums from 2017 I had on repeat in my head and in my ears
throughout 2018.


## Method {#method}


### The data {#the-data}

I track the music I stream using [ListenBrainz](http://listenbrainz.org/). It's a pretty
cool service that lets you download your data at any time
as a JSON file. Let's load my data in R.

```R
library("jsonlite")
plays <- fromJSON(lb)
```

I'm only interested in my activity from 2018, so I will filter
my dataset down to only the entries with a timecode in 2018.

```R
stamp <- as.numeric(as.POSIXct("2018-01-01", format="%Y-%m-%d"))
recentPlays <- plays[plays$timestamp > stamp, ]
nrow(recentPlays)
```

```text
12482
```

That's a lot of music! How was that listening distributed over time?

```R
library("ggplot2")
library("scales")

recentPlays$date <- as.Date(as.POSIXct(recentPlays$timestamp, origin="1970-01-01"))
plot <- ggplot(recentPlays, aes(format(recentPlays$date, "%Y-%U"))) +
    geom_bar(stat = "count") +
    labs(x = "Week", title="Tracks streamed per week.") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0)) +
    theme(panel.border = element_blank(),
          legend.key = element_blank(),
          panel.background = element_blank(),
          plot.background = element_rect(fill = "transparent",colour = NA)
    )
ggsave(file=fname, plot=plot, width=7, height=4, dpi=300, bg="transparent")
fname
```

{{< figure src="/images/2018_music_week_distribution_hist.png" caption="Figure 1: Tracks streamed per week." >}}


### Learning about each track {#learning-about-each-track}

Great, so this is everything from the year, but I want to limit the
results to just albums from 2017. Unfortunately ListenBrainz does not
include a lot of metadata. We need [MusicBrainz](https://musicbrainz.org/) to help with this.
It's a huge database with just about every song, recording, and
album imaginable. Plus it has an API, so it's ideal for getting
information about each track.

<a id="code-snippet--musicbrainz"></a>
```R
library(xml2)
library(RCurl)

# This is a pretty costly function because the MusicBrainz API
# rate limits us to one request per second. Thus, we'll set up
# a cache to eliminate redundant requests.
cacheEnv <- new.env()

getAlbums <- function(artist, song) {
    hash <- paste(artist, song)
    if (exists(hash, envir=cacheEnv)){
        return(get(hash, envir=cacheEnv))
    }
    song_stripped <- trimws(sub("\\(.*\\)", "", song))
    mburl <- sprintf(
        'https://beta.musicbrainz.org/ws/2/recording/?query=artist:"%s"+AND+recording:"%s"',
        curlEscape(artist),
        curlEscape(song_stripped)
    )
    # To comply with the rate limit.
    Sys.sleep(0.5)
    albumData <- read_xml(mburl)
    xml_ns_strip(albumData)
    releases <- xml_find_all(albumData, "/metadata/recording-list/recording/release-list//release")
    officialAlbums <- xml_find_all(albumData, '//release/status[.="Official"]/..')
    albums <- xml_find_all(officialAlbums, '//release/release-group[@type="Album" or @type="EP"]')
    results <- unique(xml_attr(albums, "id"))
    assign(hash, results, envir=cacheEnv)
    return(results)
}
```

Let's see this function in action.

```R
getAlbums("Charli XCX", "Vroom Vroom")
```

```text
d4cc6eea-bf86-4c79-a5d9-2da07df19e0e
```

This result is exactly what we'd expect: it gives a unique string for
each release group in the MusicBrainz archive.

I'm going to take a shortcut here. I don't want to query every single
song I've ever heard. Since my end goal is to compile a list of albums
sorted by the number of songs played, it is safe to assume that albums
where I have only streamed two or three songs will not make that list.
To verify this, let's graph the distribution.

```R
library("plyr")
playCounts <- count(recentPlays, c("artist_name", "track_name"))
playCounts <- playCounts[order(playCounts$freq, decreasing=T), ]
p <- ggplot(data=playCounts, aes(playCounts$freq)) + geom_histogram(binwidth=1) +
     scale_y_sqrt() +
     theme(panel.border = element_blank(),
           legend.key = element_blank(),
           panel.background = element_blank(),
           plot.background = element_rect(fill = "transparent",colour = NA))
ggsave(file=fname, plot=p, width=7, height=4, dpi=300, bg="transparent")
fname
```

{{< figure src="/images/playcounts.png" >}}

As it turns out, I only listened to a majority of these songs only one
time. Taking out songs with fewer than three plays removes a bulk of
the songs from the log while likely keeping everything interesting.
Remember, I'm trying to end up with a list of albums. Since I
generally listen to complete albums, we can assume that each track on
any album which would make the list would have at least two plays.

```R
mostFreqPlays <- playCounts[playCounts$freq > 2, ]
nrow(mostFreqPlays)
```

| x    |
|------|
| 1095 |

Now grab the release groups (albums) for each track from MusicBrainz.

```R
groups <- apply(mostFreqPlays, 1, function(x) getAlbums(x["artist_name"], x["track_name"]))
```

Get only the release groups with more than fifteen streams.

```R
library(tidyr)

mostFreqPlays$groups <- groups
unnested <- unnest(mostFreqPlays, groups)
unnested <- aggregate(freq ~ groups, unnested, sum)
unnested <- unnested[order(unnested$freq),]
nrow(unnested[unnested$freq > 15,])
```

```text
115
```

This yields 115 albums; however, we still don't know anything about
these releases. Thankfully MusicBrainz has this information as well.

```R
fetchGroup <- function(mbid) {
    mburl <- sprintf(
        "https://beta.musicbrainz.org/ws/2/release-group/%s?inc=artist-credits",
        mbid
    )
    Sys.sleep(0.25)
    groupData <- read_xml(mburl)
    xml_ns_strip(groupData)
    title <- xml_text(xml_find_first(groupData, "/metadata/release-group/title"))
    date <- as.Date(xml_text(xml_find_first(groupData, "/metadata/release-group/first-release-date")), "%Y-%m-%d")
    artist <- xml_text(xml_find_first(groupData, "/metadata/release-group/artist-credit/name-credit/artist/name"))
    artistId <- xml_text(xml_find_first(groupData, "/metadata/release-group/artist-credit/name-credit/artist/@id"))
    return(list("title" = title, "date" = date, "artist"=artist, "artistId"=artistId))
}
```

Fetch metadata for each release.

```R
mostGroups <- unnested[unnested$freq > 15,]
mostGroups$meta <- lapply(mostGroups$groups, fetchGroup)
mostGroups$date <- unlist(lapply(mostGroups$meta, function(x) x$date))
mostGroups$title <- unlist(lapply(mostGroups$meta, function(x) x$title))
mostGroups$artist <- unlist(lapply(mostGroups$meta, function(x) x$artist))
mostGroups$artistId <- unlist(lapply(mostGroups$meta, function(x) x$artistId))
albums <- mostGroups[!is.na(mostGroups$date) & mostGroups$date >= as.Date('2017-01-01') & mostGroups$date < as.Date('2018-01-01'),]
aTable <- albums[,c("title", "freq", "artist")]
aTable[order(aTable$freq, decreasing=T), ]
```

We'll save this list for the rest of the post.

The last step I'll perform is creating the thumbnail collage
for this post.

```R
library(magick)
getArt <- function(group) {
    arturl <- sprintf(
        "https://coverartarchive.org/release-group/%s/front-250.jpg",
        group
    )
    return(arturl)
}
as <- aTable[order(aTable$freq, decreasing=T), ]
r1 <- image_append(image_scale(image_read(getArt(rev(albums$groups)[1:4])), "250x250"))
r2 <- image_append(image_scale(image_read(getArt(rev(albums$groups)[5:8])), "250x250"))
r3 <- image_append(image_scale(image_read(getArt(rev(albums$groups)[c(9, 10, 12, 14)])), "250x250"))
image_write(image_append(c(r1, r2, r3), stack=TRUE), "images/albums.png", format="png")
```


## The Albums {#the-albums}

Now I'll say a few words about the albums on this list.

{{< figure src="/images/albums.png" >}}


### Charli XCX - _Pop 2_ {#charli-xcx-pop-2}

The prolific UK-based singer-songwriter has released a
masterpiece. Featuring production from the likes of A.G. Cook
and SOPHIE, _Pop 2_ is a celebration of future-facing pop
music with catchy hooks and hyper-glossy production.


### Lorde - _Melodrama_ {#lorde-melodrama}

I was completely blown away by this on my first listen.  Jack Antonoff
joined Lorde as executive producer and together they crafted a record
full of unexpected hooks and sleek arrangements. The fact that this
album is even being compared to Kate Bush's _Hounds of Love_ is a
testament to the songwriting chops of the young singer-songwriter.


### Charli XCX - _Number 1 Angel_ {#charli-xcx-number-1-angel}

Honestly I really wish that XCX3 got released last year as planned,
but these two mixtapes are possibly the greatest consolation prize
possible. PC Music-era Charli XCX just plain works. Perhaps the
most impressive accomplishment in these mixtapes is her ability
to feature so many other artists while at the same time not
being overshadowed in the slightest.


### Rina Sawayama - _RINA_ {#rina-sawayama-rina}

I love the sound and aesthetic of pop music from the late 90's and
early 2000's. It's hard for me to describe, but there's just a level
of confidence to it that is difficult to reproduce. While Rina
Sawayama by no means tries to replicate the sound, she channels
it perfectly in this Clarence Clarity-produced EP.


### Paramore - _After Laughter_ {#paramore-after-laughter}

Does Hayley Williams have one of the best voices in today's music
industry? Yes. Does Paramore keep getting better and better over time?
Also yes.


### Coma Cinema - _Loss Memory_ {#coma-cinema-loss-memory}

This was late release (early December) and it did not receive very
much attention from the music press. Nonetheless, I found it to be
a very enjoyable winter album with a raw yet removed approach to
its emotional subject matter.


### Alex Cameron - _Forced Witness_ {#alex-cameron-forced-witness}

Heartland synthpop drenched in irony and social commentary. Cameron
is simultaneously hilarious and thought-provoking.


### Baths - _Romaplasm_ {#baths-romaplasm}

Bubbly production and chippy songwriting. It's a concept album.
I still don't quite get the concept, but that's okay.


### Phoebe Bridgers - _Stranger in the Alps_ {#phoebe-bridgers-stranger-in-the-alps}

I didn't really get into this release until late this year.
Wow, there are some good songs in here! Another great winter
album with a lot of sad subjects, but also some intimate
and emotional arrangements.

Rounding out the list:

-   Vince Staples - _Big Fish Theory_
-   BROCKHAMPTON - _SATURATION III_
-   Craig Finn - _We All Want the Same Things_
-   Richard Dawson - _Peasant_
-   LCD Soundsystem - _American Dream_

[^fn:1]: AOTY publishes an aggregate of over a hundred end-of-year lists annually. Read their 2017 list [here](https://www.albumoftheyear.org/list/summary/2017/).
